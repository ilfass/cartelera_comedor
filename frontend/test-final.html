<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Final - VerificaciÃ³n Completa</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .test-header {
            background: linear-gradient(45deg, #2196f3, #21cbf3);
            color: white;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .test-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.8rem;
            max-width: 300px;
            z-index: 1000;
        }
        
        .status-item {
            margin: 0.25rem 0;
            padding: 0.25rem;
            border-radius: 0.25rem;
        }
        
        .status-success { background: rgba(76, 175, 80, 0.3); color: #4caf50; }
        .status-error { background: rgba(244, 67, 54, 0.3); color: #f44336; }
        .status-warning { background: rgba(255, 152, 0, 0.3); color: #ff9800; }
        .status-info { background: rgba(33, 150, 243, 0.3); color: #2196f3; }
        
        .test-section {
            background: #f5f5f5;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.5rem;
            border-left: 4px solid #2196f3;
        }
        
        .test-section h3 {
            margin: 0 0 0.5rem 0;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="test-status" id="test-status">
        <h4>ğŸ” Estado del Test</h4>
        <div id="status-content">
            <div class="status-item status-info">Iniciando...</div>
        </div>
    </div>

    <div class="test-header">
        <h1>ğŸ§ª Test Final - VerificaciÃ³n Completa</h1>
        <p>Verificando que todos los datos del administrador se muestren correctamente</p>
    </div>

    <div class="test-section">
        <h3>ğŸ“‹ Resumen del Problema</h3>
        <p><strong>Problema:</strong> La informaciÃ³n que se guarda en el administrador no se muestra en la pÃ¡gina secundaria.</p>
        <p><strong>Causas identificadas:</strong></p>
        <ul>
            <li>âŒ FunciÃ³n loadMessages no se llamaba en la inicializaciÃ³n</li>
            <li>âŒ Error 404 en logo de UNICEN</li>
            <li>âŒ Error en loadMixedCarousel con elemento null</li>
            <li>âŒ Elemento featured-image no encontrado</li>
        </ul>
    </div>

    <!-- PÃ¡gina de InformaciÃ³n -->
    <div class="info-page-container">
        <!-- Columna Izquierda -->
        <div class="info-left-column">
            <div class="messages-container">
                <h2 class="section-title">ğŸ“¢ Mensajes Importantes</h2>
                <div id="messages-display" class="messages-display">
                    <div class="message-item">
                        <p>Cargando mensajes...</p>
                    </div>
                </div>
            </div>
            
            <div class="featured-image-container">
                <h2 class="section-title">ğŸ–¼ï¸ Imagen Destacada</h2>
                <div id="featured-image" class="featured-image">
                    <div class="image-placeholder">ğŸ“¸</div>
                </div>
            </div>
        </div>
        
        <!-- Columna Derecha -->
        <div class="info-right-column">
            <div class="weather-container">
                <h2 class="section-title">ğŸŒ¤ï¸ Clima Actual</h2>
                <div id="weather-display" class="weather-display">
                    <div class="weather-item">
                        <p>Cargando clima...</p>
                    </div>
                </div>
            </div>
            
            <div class="info-container">
                <h2 class="section-title">â„¹ï¸ InformaciÃ³n</h2>
                <div class="info-content">
                    <div class="info-item">
                        <strong>ğŸ•’ Horario de AtenciÃ³n</strong>
                        <p>Lunes a Viernes: 9:00 - 18:00</p>
                    </div>
                    <div class="info-item">
                        <strong>ğŸ“ UbicaciÃ³n</strong>
                        <p>Campus Universitario - Tandil</p>
                    </div>
                    <div class="info-item">
                        <strong>ğŸ“§ Contacto</strong>
                        <p>comedor@unicen.edu.ar</p>
                    </div>
                </div>
            </div>
            
            <div class="qr-container">
                <h2 class="section-title">ğŸ“± Escanea para mÃ¡s info</h2>
                <div class="qr-code">
                    <div class="qr-placeholder">ğŸ“±</div>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="main-footer">
        <div class="footer-left">
            <b>Test Final - VerificaciÃ³n</b><br>Campus Universitario - Tandil
        </div>
        <div class="footer-center">Â© 2023 Universidad Nacional del Centro de la Provincia de Buenos Aires</div>
        <div class="footer-right">
            <b>Horarios de AtenciÃ³n</b><br>Lunes a Viernes: 9:00 - 18:00
        </div>
    </footer>
    
    <script>
        // ConfiguraciÃ³n
        const API_URL = 'http://localhost:3000';
        const WEATHER_API_KEY = '79bf01c7bef5ed9d9aeda331a0d552bf';
        const WEATHER_CITY = 'Tandil';
        
        // FunciÃ³n para actualizar el estado del test
        function updateTestStatus(message, type = 'info') {
            const statusContent = document.getElementById('status-content');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status-item status-${type}`;
            statusDiv.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            statusContent.appendChild(statusDiv);
            
            // Mantener solo los Ãºltimos 15 mensajes
            const messages = statusContent.querySelectorAll('.status-item');
            if (messages.length > 15) {
                messages[0].remove();
            }
        }
        
        // FunciÃ³n para formatear fechas
        const formatDate = (date) => {
            return new Date(date).toLocaleDateString('es-AR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };
        
        // Cargar mensajes
        async function loadMessages() {
            try {
                updateTestStatus('ğŸ”„ Cargando mensajes...', 'info');
                const response = await fetch(`${API_URL}/api/mensajes`);
                const messages = await response.json();
                updateTestStatus(`ğŸ“¨ ${messages.length} mensajes recibidos`, 'success');
                
                const messagesDisplay = document.getElementById('messages-display');
                if (messagesDisplay) {
                    if (messages.length > 0) {
                        messagesDisplay.innerHTML = messages.map(message => `
                            <div class="message-item ${message.destacado ? 'destacado' : ''}">
                                <h3>${message.titulo}</h3>
                                <p>${message.contenido}</p>
                                <small>${formatDate(message.fecha)}</small>
                            </div>
                        `).join('');
                        updateTestStatus('âœ… Mensajes actualizados correctamente', 'success');
                    } else {
                        messagesDisplay.innerHTML = '<div class="message-item"><p>No hay mensajes disponibles</p></div>';
                        updateTestStatus('âš ï¸ No hay mensajes disponibles', 'warning');
                    }
                } else {
                    updateTestStatus('âŒ Elemento messages-display no encontrado', 'error');
                }
            } catch (error) {
                updateTestStatus(`âŒ Error al cargar mensajes: ${error.message}`, 'error');
                const messagesDisplay = document.getElementById('messages-display');
                if (messagesDisplay) {
                    messagesDisplay.innerHTML = '<div class="message-item"><p>Error al cargar los mensajes</p></div>';
                }
            }
        }
        
        // Cargar imagen destacada
        async function loadFeaturedImage() {
            try {
                updateTestStatus('ğŸ”„ Cargando imagen destacada...', 'info');
                const response = await fetch(`${API_URL}/api/imagenes`);
                const images = await response.json();
                updateTestStatus(`ğŸ–¼ï¸ ${images.length} imÃ¡genes recibidas`, 'success');
                
                const featuredImageElement = document.getElementById('featured-image');
                if (featuredImageElement) {
                    if (images.length > 0) {
                        const featuredImage = images[0];
                        featuredImageElement.innerHTML = `
                            <img src="${featuredImage.url}" alt="${featuredImage.titulo || 'Imagen destacada'}" 
                                 style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 0.5rem;">
                            <div style="position: absolute; bottom: 0.5rem; left: 0.5rem; right: 0.5rem; 
                                       background: rgba(0,0,0,0.7); color: white; padding: 0.5rem; 
                                       border-radius: 0.25rem; font-size: 0.9rem; text-align: center;">
                                ${featuredImage.titulo || 'Imagen destacada'}
                            </div>
                        `;
                        featuredImageElement.style.position = 'relative';
                        updateTestStatus('âœ… Imagen destacada actualizada correctamente', 'success');
                    } else {
                        featuredImageElement.innerHTML = '<div class="image-placeholder">ğŸ“¸</div>';
                        updateTestStatus('âš ï¸ No hay imÃ¡genes disponibles', 'warning');
                    }
                } else {
                    updateTestStatus('âŒ Elemento featured-image no encontrado', 'error');
                }
            } catch (error) {
                updateTestStatus(`âŒ Error al cargar imagen: ${error.message}`, 'error');
                const featuredImageElement = document.getElementById('featured-image');
                if (featuredImageElement) {
                    featuredImageElement.innerHTML = '<div class="image-placeholder">ğŸ“¸</div>';
                }
            }
        }
        
        // Cargar clima
        async function loadWeather() {
            try {
                updateTestStatus('ğŸ”„ Cargando clima...', 'info');
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${WEATHER_CITY}&appid=${WEATHER_API_KEY}&units=metric&lang=es`);
                const data = await response.json();
                
                if (data.cod === 200) {
                    const temp = Math.round(data.main.temp);
                    const humidity = data.main.humidity;
                    const description = data.weather[0].description;
                    const weatherId = data.weather[0].id;
                    
                    const getWeatherEmoji = (id) => {
                        if (id >= 200 && id < 300) return 'â›ˆï¸';
                        if (id >= 300 && id < 400) return 'ğŸŒ§ï¸';
                        if (id >= 500 && id < 600) return 'ğŸŒ§ï¸';
                        if (id >= 600 && id < 700) return 'â„ï¸';
                        if (id >= 700 && id < 800) return 'ğŸŒ«ï¸';
                        if (id === 800) return 'â˜€ï¸';
                        if (id === 801) return 'ğŸŒ¤ï¸';
                        if (id >= 802 && id <= 804) return 'â˜ï¸';
                        return 'ğŸŒˆ';
                    };

                    const emoji = getWeatherEmoji(weatherId);
                    updateTestStatus(`ğŸŒ¤ï¸ Clima: ${temp}Â°C, ${description}`, 'success');
                    
                    const weatherDisplay = document.getElementById('weather-display');
                    if (weatherDisplay) {
                        weatherDisplay.innerHTML = `
                            <div class="weather-info">
                                <div class="weather-emoji">${emoji}</div>
                                <h3>${temp}Â°C</h3>
                                <p>${description}</p>
                                <p>ğŸ’§ ${humidity}%</p>
                            </div>
                        `;
                        updateTestStatus('âœ… Clima actualizado correctamente', 'success');
                    } else {
                        updateTestStatus('âŒ Elemento weather-display no encontrado', 'error');
                    }
                } else {
                    updateTestStatus(`âŒ Error en respuesta del clima: ${data.message}`, 'error');
                }
            } catch (error) {
                updateTestStatus(`âŒ Error al cargar clima: ${error.message}`, 'error');
                const weatherDisplay = document.getElementById('weather-display');
                if (weatherDisplay) {
                    weatherDisplay.innerHTML = '<p>No se pudo cargar el clima</p>';
                }
            }
        }
        
        // Verificar conectividad
        async function checkConnectivity() {
            try {
                updateTestStatus('ğŸ” Verificando conectividad con el backend...', 'info');
                const response = await fetch(`${API_URL}/api/mensajes`);
                if (response.ok) {
                    updateTestStatus('âœ… Backend conectado correctamente', 'success');
                    return true;
                } else {
                    updateTestStatus(`âŒ Backend respondiÃ³ con cÃ³digo ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                updateTestStatus(`âŒ No se puede conectar al backend: ${error.message}`, 'error');
                return false;
            }
        }
        
        // InicializaciÃ³n
        document.addEventListener('DOMContentLoaded', async () => {
            updateTestStatus('ğŸš€ Iniciando test final...', 'info');
            
            // Verificar conectividad
            const isConnected = await checkConnectivity();
            
            if (isConnected) {
                // Cargar datos
                await loadMessages();
                await loadFeaturedImage();
                await loadWeather();
                
                // Actualizar cada 30 segundos
                setInterval(loadMessages, 30000);
                setInterval(loadFeaturedImage, 30000);
                setInterval(loadWeather, 30000);
                
                updateTestStatus('âœ… Test final iniciado correctamente', 'success');
            } else {
                updateTestStatus('âŒ No se pudo iniciar el test - Backend no disponible', 'error');
            }
        });
    </script>
</body>
</html> 